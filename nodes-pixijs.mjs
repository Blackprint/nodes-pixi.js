/* MIT Licensed */
!async function(t,e,i,r,a){"use strict";if(e.exports&&e.exports!==globalThis&&Object.defineProperty(e.exports,"__esModule",{value:!0}),!t.Blackprint.Environment.isBrowser)return void console.log("@blackprint/nodes-pixi.js is only for browser, nodes will not be registered");let s=t.Blackprint.loadScope({url:import.meta.url,hasInterface:!0,hasDocs:!0});var[n,o,p]=await s.DepsLoader.js({window:["PIXI","PIXIGif","PIXIBlendModes"],local:["pixi.js","pixi.js/gif","pixi.js/advanced-blend-modes"],cdn:["https://cdn.jsdelivr.net/npm/pixi.js@8.14.0/+esm","https://cdn.jsdelivr.net/npm/pixi.js@8.14.0/gif/+esm","https://cdn.jsdelivr.net/npm/pixi.js@8.14.0/advanced-blend-modes/+esm"]});n.extensions.add(n.TickerPlugin),n.extensions.add(o.GifAsset),Object.setPrototypeOf(o.GifSprite.prototype,n.Sprite.prototype);let u=s.createContext("Pixi.js");u.EventSlot={slot:"my-private-event-slot"},s.utils.renameTypeName({Texture:n.Texture,Sprite:n.Sprite}),s.registerNode("Pixi.js/Sprite",((i=class extends s.Node{constructor(t){super(t),this.setInterface("BPIC/Pixi.js/Sprite").title="Sprite"}update(){0!==this.iface.input.Source.cables.length&&this.output.Sprite.updateTransform({x:this.input.x,y:this.input.y,scaleX:this.input.ScaleX,scaleY:this.input.ScaleY,rotate:this.input.Rotate})}}).input={Source:s.Port.Union([String,HTMLImageElement,HTMLCanvasElement,HTMLVideoElement,SVGElement,n.Texture]),x:s.Port.Default(Number,0),y:s.Port.Default(Number,0),ScaleX:s.Port.Default(Number,1),ScaleY:s.Port.Default(Number,1),Rotate:s.Port.Default(Number,0)},i.output={Sprite:n.Sprite},i)),s.registerInterface("BPIC/Pixi.js/Sprite",u.IFace.Sprite=class extends s.Interface{constructor(t){super(t)}init(){let t=this.node;var e=new n.Sprite;t.output.Sprite=e,e._emptyTexture=e.texture,this.input.Source.on("value",u.EventSlot,function(){t.output.Sprite.texture=n.Texture.from(t.input.Source),t.update(),t.routes.routeOut()}).on("disconnect",u.EventSlot,function(){var e=t.output.Sprite;e.texture=e._emptyTexture,t.routes.routeOut()})}}),s.Sketch.registerInterface("BPIC/Pixi.js/Sprite",{template:null},u.IFace.Sprite),s.registerNode("Pixi.js/Converter/GIF",((r=class extends s.Node{constructor(t){super(t),this.setInterface().title="GIF Loader"}async update(){if(this.input.URL){let t=new o.GifSprite({source:await n.Assets.load({src:this.input.URL,format:"gif",parser:"gifLoader"}),animationSpeed:1,loop:!0,autoPlay:!0});t.play(),console.log(t,o.GifSprite,n.Sprite),this.output.Sprite=t}else{let t=this.output.Sprite;this.output.Sprite=null,t?.stop()}}}).input={URL:String},r.output={Sprite:n.Sprite},r)),s.registerNode("Pixi.js/Display/Canvas",((a=class extends s.Node{constructor(t){super(t),this.setInterface("BPIC/Pixi.js/Display/Canvas").title="Display Canvas"}}).input={Sprite:s.Port.ArrayOf(n.Sprite),Start:s.Port.Trigger(function({iface:t}){t.app.ticker.start()}),Stop:s.Port.Trigger(function({iface:t}){t.app.ticker.stop()})},a.output={VideoTrack:MediaStreamTrack},a));var l=!0;s.registerInterface("BPIC/Pixi.js/Display/Canvas",u.IFace.Canvas=class extends s.Interface{async init(){let e;if(l&&(e=Date.now()),this.app=new n.Application,await this.app.init({background:"#1099bb",autoStart:!1}),l){let i="Pixi.js init time: "+(Date.now()-e)+"ms";t.SmallNotif?SmallNotif.add(i):console.log(i),l=!1}this.container=this.app.stage,this.canvas=this.app.canvas,this.app.renderer.resize(512,256),this.initEvent()}initEvent(){var t=this;const{IInput:e,IOutput:i,Input:r,Output:a}=t.ref;e.Sprite.on("value",u.EventSlot,function({cable:e}){e.value&&0!==e.value.length&&(t.app.stage.addChild(e.value),t.app.start())}),e.Sprite.on("disconnect",u.EventSlot,function({target:i}){t.app.stage.removeChild(i.value),0===e.Sprite.cables.length&&t.app.stop()}),i.VideoTrack.on("connect",u.EventSlot,function(){t.mediaStream=t.canvas.captureStream(),a.VideoTrack=t.mediaStream.getVideoTracks()[0]}),i.VideoTrack.on("disconnect",u.EventSlot,function(){0===this.cables.length&&(t.mediaStream.removeTrack(a.VideoTrack),a.VideoTrack.stop(),a.VideoTrack=t.mediaStream=void 0)})}})}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:this,"undefined"!=typeof module?module:{exports:this});
//# sourceMappingURL=nodes-pixijs.mjs.map